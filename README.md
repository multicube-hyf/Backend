# **MultiCube Backend**
MutiCube is a web app to teach numbers, addition and multiplication to children between 7 and 10 years old.

It also allows schools to manage classrooms, students and teachers for distance education in times of COVID-19.

- 	[Frontend](https://github.com/multicube-hyf/frontend)

# **Backend architecture**

## **Database design**
![Database structure](https://user-images.githubusercontent.com/59319966/100209146-d0400600-2f09-11eb-859f-7d115a47a1b0.png "Database structure")


## **Installation**
### **0 | Requirements**

MultiCube runs on virtually any system where Node.js is supported. This means it runs on Linux, macOS, Windows as well as container solutions such as Docker and Heroku.
#### **Versions**
- MongoDB 4.4
- NodeJS 12.8

### **1 | Create and/or configure environement variables**

- Create a .env file at the root of the backend folder
- Replace all variables noted with $ below, and save it to the .env file
```
PORT=$port_number
DB_CNN=mongodb://localhost:27017/$db_name
JWT_SECRET_SEED=$long_random_characters
```

### **2 | Installation of packages with npm**

- `npm i`

### **3 | Run the server**
- To run in development: `npm run dev`
- To run in production:  `npm start`

### **API endpoints**
---

**URL** https://multicube-backend.herokuapp.com/

---

<!-- > Values required in **`bold`**. -->

<!-- #### **USERS** | **`user`**

| field         | data type        | metadata                    |
| :------------ | :--------------- | :-------------------------- |
| id            | unsigned integer | generated by database,unique|
| username      | string           | required, unique            |
| email         | string           | unique                      |
| password      | string           | required                    |
| name          | string           | required                    |
| lastName      | string           | required                    |
| phone         | string           |                             |
| role          | string           | required                    |
| created_at    | datetime         | generated by database       |
| updated_at    | datetime         | generated by database       | -->


<!-- #### **USERS** | **`student`**

| field           | data type        | metadata                    |
| :-------------- | :--------------- | :-------------------------- |
| userId          | string           | required, unique            |
| gender          | string           | required                    |
| dad_name        | string           |                             |
| dad_lastName    | string           |                             |
| mom_name        | string           |                             |
| mom_lastName    | string           |                             |
| last_connection | datetime         | generated by server         | -->

#### **Add an user**

**`POST /api/users/register`**

##### **Request**

A json object for the user to register with **`username`**, **`name`**, **`lastName`**, `email`, **`password`**, **`role`** and `phone`.

```
{
  "username": "Larizaak",
  "name": "Isaak",
  "lastName": "Larsen",
  "email": "izaak@example.com",
  "password": "really-strong-password",
  "role": "admin",
  "phone": "+xx xxx xx xx xx"
}
```

##### **Response `201`**

A json object for the registered user with `msg` and `token`. 

```
{
  "msg":"User created successfully",
  "token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1CJlbWFpbCI6ImphY2tAZXc2VybmFtZSI6ImphY2siLhhbXBsZS5jb20iLCJpYXQiOjE1OTg2MTc2MTksImV4cCI6MTYwMTIwOTYxOX0.s85ti_rzBVHJ6Gt1MY7seYfdcjB6sR939p2CexA40gI"
}
```
#### **Log in**

**`POST /api/users/login`**

##### **Request**

A json object for the account to login with either **`username`** and **`password`** .

```
{
  "username": "larizaak",
  "password": "password"
}
```

##### ****Response `200`****

A json object for the logged in account with `name` and `token`

```
{
  "name": "User name",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1CJlbWFpbCI6ImphY2tAZXc2VybmFtZSI6ImphY2siLhhbXBsZS5jb20iLCJpYXQiOjE1OTg2MTc2MTksImV4cCI6MTYwMTIwOTYxOX0.s85ti_rzBVHJ6Gt1MY7seYfdcjB6sR939p2CexA40gI"
}
```

#### **Update an user**

**`PUT /api/users/:id`**

##### **Request**

A json object for the user to update with any of `username`, `email`, `password`, `phone`, `role`.

```
{
  "phone": "+xx xxx xx xx xx",
  "role": "teacher"
}
```

##### **Response `200`**

A json object for the updated user with `msg`.

```
{
  "msg": "User updated successfully"
}
```

#### **Delete an user**

**`DELETE /api/users/:id`**

##### **Response `200`**

A json object for the deleted account with confirmation `msg`.

```
{
  "msg": "User deleted successfully"
}
```
#### For users with role of type `admin`: Get one user of type student.
**`GET /api/users/:id`**
##### **Response `200`**
A json object with  `name`, `lastName`, `progress` and `lastConnection`.

```
{
  "name": "Elisa",
  "lastName": "Gutierrez",
  "progress": 3,
  "lastConnection": "November 19th 2020, 4:49:15 pm"
}
```

#### For users with role of type `admin`: Get a list of all the users

**`GET /api/users`**

##### **Response `200`**

A json object with  an array of `users`.

```
{
  "users": [
    {
      "id": "5f9ed5ce47c42738d03d178d",
      "username": "larizaak",
      "name": "Isaak",
      "role": "teacher",
      "LastConnection": "November 19th 2020, 4:49:15 pm"
    },
    {
      "id": "5f9ed5ce47d03d178d",
      "username": "vernonB",
      "name": "Vernon",
      "role": "admin",
      "LastConnection": "November 19th 2020, 4:49:15 pm"
    },
    {
      "id": "5f9ed5ce47c42738d03d178d",
      "username": "BoydH",
      "role": "student",
      "LastConnection": "November 19th 2020, 4:49:15 pm"
    },
  ]
}
```
<!-- #### **For users with role of type `admin`: Get a list of all the users with role of students**

**`GET /api/users/students`**

##### **Response `200`**

A json object with an array of `students`.

```
{
  "students": [
    {
      "id": "5f9ed5ce47c42738d03d178d",
      "username": "jaoBel",
      "email": "jao@example.com",
      "name": "Jao",
      "lastName": "Bell",
      "role": "student",
      "gender": "masculine"
      "mom_name": "Lisa",
      "mom_lastName": "Addams",
      "phone": "+xx xxx xx xx xx",
      "created_at": "2025-01-05T14:30:00Z",
      "updated_at": "2025-05-05T14:30:00Z",
      "last_connection": "2025-07-05T14:30:00Z"
    },
    {
      "id": "5f9ed5ce47c42738d03d178d",
      "username": "BoydH",
      "email": "harold@example.com",
      "name": "Harold",
      "lastName": "Boyd",
      "role": "student",
      "gender": "masculine"
      "dad_name": "Carl",
      "dad_lastName": "Boyd",
      "phone": "+xx xxx xx xx xx",
      "created_at": "2025-01-05T14:30:00Z",
      "updated_at": "2025-05-05T14:30:00Z",
      "last_connection": "2025-07-05T14:30:00Z"
    },
    {
      "id": "5f9ed5ce47c42738d03d178d",
      "username": "fisherAi",
      "email": "aiesha@example.com",
      "name": "Aiesha",
      "lastName": "Fischer",
      "role": "student",
      "gender": "feminine"
      "dad_name": "Natan",
      "dad_lastName": "Fischer",
      "phone": "+xx xxx xx xx xx",
      "created_at": "2025-01-05T14:30:00Z",
      "updated_at": "2025-05-05T14:30:00Z",
      "last_connection": "2025-07-05T14:30:00Z"
    },
  ]
}

```

#### **For users with role of type `admin`: Get a list of all the users with role of teachers**

**`GET /api/users/teachers`**

##### **Response `200`**

A json object with an array of `teachers`.

```
{
  "teachers": [
    {
      "id": "5f9ed5ce47c42738d03d178d",
      "username": "larizaak",
      "email": "izaak@example.com",
      "name": "Isaak",
      "lastName": "Larsen",
      "role": "teacher",
      "phone": "+xx xxx xx xx xx",
      "created_at": "2025-04-05T14:30:00Z"
      "updated_at": "2025-05-05T14:30:00Z"
    },
    {
      "id": "5f9ed5ce47c42738d03d178d",
      "username": "keziaT",
      "email": "kezia@example.com",
      "name": "Kezia",
      "lastName": "Townsend",
      "role": "teacher",
      "phone": "+xx xxx xx xx xx",
      "created_at": "2025-04-05T14:30:00Z",
      "updated_at": "2025-05-05T14:30:00Z"
    },
    {
      "id": "5f9ed5ce47c42738d03d178d",
      "username": "BurtonCha",
      "email": "Charlton@example.com",
      "name": "Charlton",
      "lastName": "Burton",
      "role": "teacher",
      "phone": "+xx xxx xx xx xx",
      "created_at": "2025-04-05T14:30:00Z",
      "updated_at": "2025-05-05T14:30:00Z"
    },
  ]
}

``` 
#### **For users with role of type `admin`: Student data broken down by gender**

**`GET /api/users/students/gender`**

##### **Response `200`**

A json object with student data by gender with `boys`, `girls` and `other`.

```
{
  "gender": {
    "boys": 26,
    "girls": 15,
    "other": 3
  }
}
``` -->

<!-- ### **CLASSROOMS** | **`classroom`**

| field                     | data type | metadata                                    |
| :-----------------------  | :-------- | :------------------------------------------ |
| id                        | uuid      | generated by database, unique               |
| teachers_ids              | array     | required                                    |
| students_ids              | array     |                                             |
| title                     | string    | required                                    |
| description               | string    |                                             |
| msgs                  | array     |                                             |
| created_at                | datetime  |    generated by database                    |
| updated_at                | datetime  |    generated by database                    | -->


#### **Create a classroom**

**`POST /api/classroom`**

##### **Request**

A json object for the classroom to create with  **`title`**, `description`, **`teachers_usernames`**, `students_usernames` and `msgs`.

```
{
  "title": "Class 8",
  "description": "kids from 7 to 9 years old"
}

```

##### **Response `201`**

A json object for the created classroom with `msg` and `id`.

```
{
  "msg": "classroom created successfully",
  "id": "5f9ed5ce47c42738d03d178d"
}

```

#### **Update a classroom**

**`PUT /api/classrooms/:id`**

##### **Request**

A json object for the classroom to update with any of `title`, `description`, `teachers_usernames`, `students_usernames` and  `msgs`.

```
{
  "title": "Class 9",
  "description": "My new description"
}
```

##### **Response `200`**

A json object for the updated classroom with `msg`.

```
{
 "msg": "Classroom updated successfully"
}
```

#### **Delete a classroom**

**`DELETE /api/classrooms/:id`**

##### **Response `200`**

A json object for the deleted meeting with `msg`.

```
{
  "msg": "Classroom deleted successfully"
}
```

#### **For users with role  `admin`: Get a list of all the classrooms**

**`GET /api/classrooms/`**

##### **Response `200`**

A json object with  and an array of `classrooms`.

```
{
  "classrooms": [
          {
          "id": "5f9ed5ce47c42738d03d178d",
          "title": "Class 8",
          "description": "My class 8",
        },
        {
          "id": "5f9ed5ce47c4558d03d178d",
          "title": "Class 10",
          "description": "My new description",
          
        },
        {
          "id": "5f9ed5ce47c42738d03d178d",
          "title": "Class 9",
          "description": "My new description"
        }
      ]
}

```
<!-- #### **For users with role  `admin`: Get a list of all the students in a  classrooms**

**`GET /api/classrooms/:id/students`**

##### **Response `200`**

A json object with  and an array of `students` for that specific classroom.
(I was thinking about returning just an array with students usernames)

```
{
  "students": [
      {
        "id": "5f9ed5ce47c42738d03d178d",
        "username": "jaoBel",
        "email": "jao@example.com",
        "name": "Jao",
        "lastName": "Bell",
        "role": "student",
        "gender": "masculine"
        "mom_name": "Lisa",
        "mom_lastName": "Addams",
        "phone": "+xx xxx xx xx xx",
        "created_at": "2025-01-05T14:30:00Z"
        "updated_at": "2025-05-05T14:30:00Z"
        "last_connection": "2025-07-05T14:30:00Z"
      },
      {
        "id": "5f9ed5ce47c42738d03d178d",
        "username": "BoydH",
        "email": "harold@example.com",
        "name": "Harold",
        "lastName": "Boyd",
        "role": "student",
        "gender": "masculine"
        "dad_name": "Carl",
        "dad_lastName": "Boyd",
        "phone": "+xx xxx xx xx xx",
        "created_at": "2025-01-05T14:30:00Z"
        "updated_at": "2025-05-05T14:30:00Z"
        "last_connection": "2025-07-05T14:30:00Z"
      },
      {
        "id": "5f9ed5ce47c42738d03d178d",
        "username": "fisherAi",
        "email": "aiesha@example.com",
        "name": "Aiesha",
        "lastName": "Fischer",
        "role": "student",
        "gender": "feminine"
        "dad_name": "Natan",
        "dad_lastName": "Fischer",
        "phone": "+xx xxx xx xx xx",
        "created_at": "2025-01-05T14:30:00Z"
        "updated_at": "2025-05-05T14:30:00Z"
        "last_connection": "2025-07-05T14:30:00Z"
      },
  ]
}
``` -->
#### **For users with role  `admin`: Get details of a classroom**

**`GET /api/classrooms/:id`**

##### **Response `200`**

A json object with the details of the  classroom with `id`, `title`, `description`, `teachers_usernames`, `students_usernames`, `msgs`, `created_at` and `updated_at`.

```
{
  "classroom": 
    {
      "title": "Class 8",
      "description": "My class 8",
      "teachers_ids": ["teacher1", "teacher2"],
      "students_ids": ["fisherAi", "BoydH", "jaoBel"],
      "messages": [
        {
          title: "first msg",
          description: "This is the fist msg for this class",
          author_username: "teacher1"
        }
      ],
    }
}
```


<!-- #### **For users with role  `admin`: Get a list of all the teachers in a  classrooms**

**`GET /api/classrooms/:id/teachers`**

##### **Response `200`**

A json object with  and an array of `teachers` for that specific classroom.
(I was thinking about returning just an array with teachers usernames)

```
{
  teachers: [
    {
      "id": "5f9ed5ce47c42738d03d178d",
      "username": "larizaak",
      "email": "izaak@example.com",
      "name": "Isaak",
      "lastName": "Larsen",
      "role": "teacher",
      "phone": "+xx xxx xx xx xx",
      "created_at": "2025-04-05T14:30:00Z"
      "updated_at": "2025-05-05T14:30:00Z"
    },
    {
      "id": "5f9ed5ce47c42738d03d178d",
      "username": "keziaT",
      "email": "kezia@example.com",
      "name": "Kezia",
      "lastName": "Townsend",
      "role": "teacher",
      "phone": "+xx xxx xx xx xx",
      "created_at": "2025-04-05T14:30:00Z"
      "updated_at": "2025-05-05T14:30:00Z"
    },
    {
      "id": "5f9ed5ce47c42738d03d178d",
      "username": "BurtonCha",
      "email": "Charlton@example.com",
      "name": "Charlton",
      "lastName": "Burton",
      "role": "teacher",
      "phone": "+xx xxx xx xx xx",
      "created_at": "2025-04-05T14:30:00Z"
      "updated_at": "2025-05-05T14:30:00Z"
    },
  ]
}

``` -->

<!-- ### **msgS** | **`msg`** -->

<!-- | field                     | data type | metadata                                    |
| :-----------------------  | :-------- | :------------------------------------------ |
| id                        | uuid      | generated by database, unique               |
| author_id                 | string    | required                                    |
| description               | string    | required                                    |
| title                     | string    | required                                    |
| class_id                  | datetime  | generated by database                       | -->